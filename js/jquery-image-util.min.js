/*!
 * jquery-image-util v1.1 (https://github.com/honguangli/jquery-image-util)
 * Copyright honguangli
 * Licensed under the MIT license
 */
(function(a){"use strict";function b(b,c){const d=this;if(d.options=a.extend(!1,{mode:0,oid:null,rid:null,size:0,images:[],autoImageId:0,data:[],preview:!1,uploadFun:null,deleteFun:null,msgFun:null},c),d.element=b,!a.isFunction(d.options.uploadFun))return void d.msg("upload function is necessary");if(!a.isFunction(d.options.deleteFun))return void d.msg("delete function is necessary");d.options.oid=n++,null==d.options.rid&&(d.options.rid=d.options.oid),d.options.images=[];for(let a=0,f=d.options.data.length;a<f;a++){const b=d.options.data[a];d.options.images.push(e(d.options.autoImageId++,b,k))}d.start(),d.options.preview&&a.startImageViewer(d.element,".upload-image",window.top,!0)}function c(a){return a===0?"\u7B49\u5F85\u4E0A\u4F20":a===1?"\u6B63\u5728\u4E0A\u4F20":a===2?"\u5DF2\u4E0A\u4F20":a===500?"\u4E0A\u4F20\u5931\u8D25":a===200?"\u4E0A\u4F20\u6210\u529F":"\u72B6\u6001\u5F02\u5E38"}function d(a){return a===0?"upload-default":a===1?"upload-doing":a===2?"upload-finish":a===500?"upload-failure":a===200?"upload-success":"upload-warning"}function e(a,b,c,d,e,f){this;return void 0===d&&(d=""),void 0===e&&(e=""),void 0===f&&(f=null),{id:a,name:d,originSrc:e,originData:f,src:b,status:c}}function f(a,b,e,f){const g=[];g.push("<div class=\"upload-image-item\" id=\"upload-image-item-"+b+"-"+f.id+"\" data-id=\""+f.id+"\">"),g.push("<img class=\"upload-image\" src=\""+f.src+"\">"),g.push("<div class=\"upload-image-indicator\">"),g.push("<p class=\""+d(f.status)+"\"><i class=\"fa fa-circle\"></i> "+c(f.status)+"</p>"),g.push("</div>"),g.push("<div class=\"upload-image-control\">"),g.push("<a href=\"javascript:void(0);\" class=\"delete-a\" title=\"\u5220\u9664\"><i class=\"fa fa-trash\"></i></a>"),g.push("</div>"),g.push("</div>"),a.children(".upload-images").append(g.join(""))}function g(a,b,e,f){const g=["<div class=\"upload-image-item\" id=\"upload-image-item-"+b+"-"+f.id+"\" data-id=\""+f.id+"\">","<img class=\"upload-image\" src=\""+f.originSrc+"\">","<div class=\"upload-image-indicator\">","<p class=\""+d(f.status)+"\"><i class=\"fa fa-circle\"></i> "+c(f.status)+"</p>","</div>","<div class=\"upload-image-control\">"];switch(e){case 1:break;case 2:g.push("<a href=\"javascript:void(0);\" class=\"upload-a\" title=\"\u4E0A\u4F20\"><i class=\"fa fa-upload\"></i></a>");break;default:}g.push("<a href=\"javascript:void(0);\" class=\"delete-a\" title=\"\u5220\u9664\"><i class=\"fa fa-trash\"></i></a>"),g.push("</div>"),g.push("</div>"),a.children(".upload-images").append(g.join(""))}function h(b,e,f,g){const h=a("#upload-image-item-"+e+"-"+g.id);if(0!==h.length)switch(h.find(".upload-image-indicator").html("<p class=\""+d(g.status)+"\"><i class=\"fa fa-circle\"></i> "+c(g.status)+"</p>"),g.status){case m:h.children(".upload-image").attr("src",g.src),h.children(".upload-image-control").html("<a href=\"javascript:void(0);\" class=\"delete-a\" title=\"\u5220\u9664\"><i class=\"fa fa-trash\"></i></a>");break;case l:h.children(".upload-image-control").html("<a href=\"javascript:void(0);\" class=\"upload-a\" title=\"\u91CD\u65B0\u4E0A\u4F20\"><i class=\"fa fa-upload\"></i></a><a href=\"javascript:void(0);\" class=\"delete-a\" title=\"\u5220\u9664\"><i class=\"fa fa-trash\"></i></a>");break;default:h.children(".upload-image-control").html("<a href=\"javascript:void(0);\" class=\"delete-a\" title=\"\u5220\u9664\"><i class=\"fa fa-trash\"></i></a>");}}a.startImageViewer=function(b,c,d,e){void 0===d&&(d=window.top),void 0===c&&(c="img"),e?b.find(c).css("cursor","pointer"):b.children(c).css("cursor","pointer"),b.on("click",c,function(){a(this).attr("data-image-viewer-active","on");a(this).attr("src");let f=a(this).index();const g=[];e?(b.find(c).css("cursor","pointer"),b.find(c).each(function(b,c){g.push({src:a(c).attr("src")}),"on"===a(this).attr("data-image-viewer-active")&&(f=b)})):(b.children(c).css("cursor","pointer"),b.children(c).each(function(b,c){g.push({src:a(c).attr("src")})})),a(this).removeAttr("data-image-viewer-active"),d.$.openImagesViewer(g,f)})},a.openImagesViewer=function(b,c,d){0===a(".image-viewer-box").length&&a("body").append("<div class=\"image-viewer-box\"></div>");const e=a(".image-viewer-box");let f=["<ul class=\"images\" style=\"display: none;\">"];for(let a=0;a<b.length;a++)f.push("<li><img src=\""+b[a].src+"\"></li>");f.push("</ul>"),e.html(f.join(""));const g=a(".image-viewer-box .images");g.viewer(a.extend(!0,{container:".image-viewer-box",zIndex:99999999,title:!1,toolbar:{"zoom-in":!0,"zoom-out":!0,"one-to-one":!0,reset:!0,prev:!0,play:!1,next:!0,"rotate-left":!0,"rotate-right":!0,"flip-horizontal":!0,"flip-vertical":!0}},d)),g.find("img").eq(c).click()};const i=0,j=1,k=2,l=500,m=200;let n=0;b.prototype={start:function(){const b=this,f=b.element;f.attr("data-oid",b.options.oid);const k=["<div class=\"upload-images-control\">","<a href=\"javascript:void(0);\" class=\"select-a\" title=\"\u9009\u62E9\u56FE\u7247\">\u9009\u62E9\u56FE\u7247<input type=\"file\" title=\"\u9009\u62E9\u56FE\u7247\"></a>","<a href=\"javascript:void(0);\" class=\"eye-a\" data-show=\"true\" title=\"\u9690\u85CF\"><i class=\"fa fa-eye\"></i></a>"];switch(b.options.mode){case 1:case 2:k.push("<a href=\"javascript:void(0);\" class=\"upload-multi-a\" title=\"\u6279\u91CF\u4E0A\u4F20\"><i class=\"fa fa-upload\"></i></a>");break;default:}k.push("</div>"),k.push("<div class=\"upload-images\">");for(let a=0,e=b.options.images.length;a<e;a++){const e=b.options.images[a];k.push("<div class=\"upload-image-item\" data-id=\""+e.id+"\">"),k.push("<img class=\"upload-image\" src=\""+e.src+"\">"),k.push("<div class=\"upload-image-indicator\">"),k.push("<p class=\""+d(e.status)+"\"><i class=\"fa fa-circle\"></i> "+c(e.status)+"</p>"),k.push("</div>"),k.push("<div class=\"upload-image-control\">"),k.push("<a href=\"javascript:void(0);\" class=\"delete-a\" title=\"\u5220\u9664\u56FE\u7247\"><i class=\"fa fa-trash\"></i></a>"),k.push("</div>"),k.push("</div>")}k.push("</div>"),f.append(k.join("")),f.on("click",".select-a input[type=\"file\"]",function(){if(0<b.options.size&&b.options.size<=b.options.images.length)return b.msg("\u6700\u591A\u53EF\u9009\u62E9"+b.options.size+"\u5F20\u56FE\u7247"),a(this).val(""),!1}).on("change",".select-a input[type=\"file\"]",function(){if(0<b.options.size&&b.options.size<=b.options.images.length)return b.msg("\u6700\u591A\u53EF\u9009\u62E9"+b.options.size+"\u5F20\u56FE\u7247"),a(this).val(""),!1;const c=a(this).val(),d=c.substring(c.lastIndexOf(".")).toLowerCase(),k=window.URL.createObjectURL(this.files[0]);if(!d.match(/.png|.jpg|.jpeg|.gif/))return b.msg("\u56FE\u7247\u683C\u5F0F\u9519\u8BEF\uFF0C\u56FE\u7247\u683C\u5F0F\u5FC5\u987B\u4E3A\uFF1Apng/jpg/jpeg/gif"),a(this).val(""),!1;const l=e(b.options.autoImageId++,"",i,c,k,this.files[0]);switch(g(f,b.options.oid,b.options.mode,l),b.options.images.push(l),a(this).val(""),b.options.mode){case 1:case 2:break;default:a.isFunction(b.options.uploadFun)?(l.status=j,h(f,b.options.oid,b.options.mode,l),b.options.uploadFun(b.options.rid,l.id,l.originData)):b.msg("upload function is necessary");}}).on("click",".eye-a",function(){"true"===a(this).attr("data-show")?(a(this).attr("data-show","false"),a(this).html("<i class=\"fa fa-eye-slash\"></i>"),f.children(".upload-images").css("display","none")):(a(this).attr("data-show","true"),a(this).html("<i class=\"fa fa-eye\"></i>"),f.children(".upload-images").css("display","flex"))}).on("click",".upload-multi-a",function(){b.upload()}).on("click",".upload-a",function(){const c=a(this).closest(".upload-image-item"),d=parseInt(a(c).attr("data-id"));for(let c=0,e=b.options.images.length;c<e;c++){const e=b.options.images[c];if(e.id===d){if(e.status!==i&&e.status!==l)break;a.isFunction(b.options.uploadFun)?(e.status=j,h(f,b.options.oid,b.options.mode,e),b.options.uploadFun(b.options.rid,e.id,e.originData)):b.msg("upload function is necessary");break}}}).on("click",".delete-a",function(){const c=a(this).closest(".upload-image-item"),d=parseInt(a(c).attr("data-id"));for(let a=0,c=b.options.images.length;a<c;a++){const c=b.options.images[a];if(c.id===d){b.options.images.splice(a,1);break}}c.remove(),a.isFunction(b.options.deleteFun)?b.options.deleteFun(b.options.rid,b.val()):b.msg("delete function is necessary")})},update:function(b){b=a.extend(!1,{id:-1,status:!1,src:""},b);const c=this,d=c.element;for(let a=0,e=c.options.images.length;a<e;a++){const e=c.options.images[a];if(e.id===b.id){b.status?(e.status=m,e.originSrc="",e.originData=null):e.status=l,e.src=b.src,h(d,c.options.oid,c.options.mode,e);break}}},upload:function(){const b=this,c=b.element,d=b.options.images.length;if(0===d)return void b.msg("\u8BF7\u5148\u9009\u62E9\u56FE\u7247");let e=0,f=0;for(let g=0;g<d;g++){const d=b.options.images[g];switch(d.status){case i:case l:e++;break;case j:f++;case k:case m:default:continue;}if(a.isFunction(b.options.uploadFun))d.status=j,h(c,b.options.oid,b.options.mode,d),b.options.uploadFun(b.options.rid,d.id,d.originData);else return void b.msg("upload function is necessary")}0==e&&0===f?b.msg("\u5DF2\u5168\u90E8\u4E0A\u4F20\u5B8C\u6210"):0<f&&b.msg("\u56FE\u7247\u6B63\u5728\u4E0A\u4F20")},clear:function(){const a=this,b=a.element;a.options.images=[],b.children(".upload-images").html("")},push:function(a){const b=this,c=b.element;for(let d=0,g=a.length;d<g;d++){const g=a[d],h=e(b.options.autoImageId++,g,k);f(c,b.options.oid,b.options.mode,h),b.options.images.push(h)}},val:function(){const a=this,b=[];for(let c=0,d=a.options.images.length;c<d;c++)(a.options.images[c].status===k||a.options.images[c].status===m)&&b.push(a.options.images[c].src);return b},msg:function(b){const c=this;a.isFunction(c.options.msgFun)?c.options.msgFun(c.options.rid,b):console.log("image-upload-msg",c.options.rid,b)}},a.fn.imageUpload=function(c){const d=arguments;return this.each(function(){const e=a(this);let f=e.data("imageUpload");f||(f=new b(e,c),e.data("imageUpload",f)),"string"==typeof c&&f[c].apply(f,Array.prototype.slice.call(d,1))})}})($);