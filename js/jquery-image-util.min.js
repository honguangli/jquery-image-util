/*!
 * jquery-image-util v1.0 (https://github.com/honguangli/jquery-image-util)
 * Copyright honguangli
 * Licensed under the MIT license
 */
!function(s){"use strict";s.startImageViewer=function(i,t,a,e){void 0===a&&(a=window.top),void 0===t&&(t="img"),e?i.find(t).css("cursor","pointer"):i.children(t).css("cursor","pointer"),i.on("click",t,function(){const o="data-image-viewer-active";s(this).attr(o,"on");s(this).attr("src");let n=s(this).index();const l=[];e?(i.find(t).css("cursor","pointer"),i.find(t).each(function(i,t){l.push({src:s(t).attr("src")}),"on"===s(this).attr(o)&&(n=i)})):(i.children(t).css("cursor","pointer"),i.children(t).each(function(i,t){l.push({src:s(t).attr("src")})})),s(this).removeAttr(o),a.$.openImagesViewer(l,n)})},s.openImagesViewer=function(i,t,a){0===s(".image-viewer-box").length&&s("body").append('<div class="image-viewer-box"></div>');const e=s(".image-viewer-box");let o=[];o.push('<ul class="images" style="display: none;">');for(let s=0;s<i.length;s++)o.push('<li><img src="'+i[s].src+'"></li>');o.push("</ul>"),e.html(o.join(""));const n={container:".image-viewer-box",zIndex:99999999,title:!1,toolbar:{"zoom-in":!0,"zoom-out":!0,"one-to-one":!0,reset:!0,prev:!0,play:!1,next:!0,"rotate-left":!0,"rotate-right":!0,"flip-horizontal":!0,"flip-vertical":!0}},l=s(".image-viewer-box .images");l.viewer(s.extend(!0,n,a)),l.find("img").eq(t).click()};const i=0,t=1,a=2,e=500,o=200;let n=0;function l(i,t){const e=this;if(e.options=s.extend(!1,{mode:0,oid:null,rid:null,size:0,images:[],autoImageId:0,data:[],preview:!1,uploadFun:null,deleteFun:null,msgFun:null},t),e.element=i,s.isFunction(e.options.uploadFun))if(s.isFunction(e.options.deleteFun)){e.options.oid=n++,null==e.options.rid&&(e.options.rid=e.options.oid),e.options.images=[];for(let s=0,i=e.options.data.length;s<i;s++){const i=e.options.data[s];e.options.images.push(r(e.options.autoImageId++,i,a))}e.start(),e.options.preview&&s.startImageViewer(e.element,".upload-image",parent,!0)}else e.msg("delete function is necessary");else e.msg("upload function is necessary")}function c(s){switch(s){case i:return"等待上传";case t:return"正在上传";case a:return"已上传";case e:return"上传失败";case o:return"上传成功";default:return"状态异常"}}function p(s){switch(s){case i:return"upload-default";case t:return"upload-doing";case a:return"upload-finish";case e:return"upload-failure";case o:return"upload-success";default:return"upload-warning"}}function r(s,i,t,a,e,o){return void 0===a&&(a=""),void 0===e&&(e=""),void 0===o&&(o=null),{id:s,name:a,originSrc:e,originData:o,src:i,status:t}}function u(i,t,a,n){const l=s("#upload-image-item-"+t+"-"+n.id);if(0!==l.length)switch(l.find(".upload-image-indicator").html('<p class="'+p(n.status)+'"><i class="fa fa-circle"></i> '+c(n.status)+"</p>"),n.status){case o:l.children(".upload-image").attr("src",n.src),l.children(".upload-image-control").html('<a href="javascript:void(0);" class="delete-a" title="删除"><i class="fa fa-trash"></i></a>');break;case e:l.children(".upload-image-control").html('<a href="javascript:void(0);" class="upload-a" title="重新上传"><i class="fa fa-upload"></i></a><a href="javascript:void(0);" class="delete-a" title="删除"><i class="fa fa-trash"></i></a>');break;default:l.children(".upload-image-control").html('<a href="javascript:void(0);" class="delete-a" title="删除"><i class="fa fa-trash"></i></a>')}}l.prototype={start:function(){const a=this,o=a.element;o.attr("data-oid",a.options.oid);const n=[];switch(n.push('<div class="upload-images-control">'),n.push('<a href="javascript:void(0);" class="select-a" title="选择图片">选择图片<input type="file" title="选择图片"></a>'),n.push('<a href="javascript:void(0);" class="eye-a" data-show="true" title="隐藏"><i class="fa fa-eye"></i></a>'),a.options.mode){case 1:case 2:n.push('<a href="javascript:void(0);" class="upload-multi-a" title="批量上传"><i class="fa fa-upload"></i></a>')}n.push("</div>"),n.push('<div class="upload-images">');for(let s=0,i=a.options.images.length;s<i;s++){const i=a.options.images[s];n.push('<div class="upload-image-item" data-id="'+i.id+'">'),n.push('<img class="upload-image" src="'+i.src+'">'),n.push('<div class="upload-image-indicator">'),n.push('<p class="'+p(i.status)+'"><i class="fa fa-circle"></i> '+c(i.status)+"</p>"),n.push("</div>"),n.push('<div class="upload-image-control">'),n.push('<a href="javascript:void(0);" class="delete-a" title="删除图片"><i class="fa fa-trash"></i></a>'),n.push("</div>"),n.push("</div>")}n.push("</div>"),o.append(n.join("")),o.on("click",'.select-a input[type="file"]',function(){if(a.options.size>0&&a.options.size<=a.options.images.length)return a.msg("最多可选择"+a.options.size+"张图片"),s(this).val(""),!1}).on("change",'.select-a input[type="file"]',function(){if(a.options.size>0&&a.options.size<=a.options.images.length)return a.msg("最多可选择"+a.options.size+"张图片"),s(this).val(""),!1;const e=s(this).val(),n=e.substring(e.lastIndexOf(".")).toLowerCase(),l=window.URL.createObjectURL(this.files[0]);if(!n.match(/.png|.jpg|.jpeg|.gif/))return a.msg("图片格式错误，图片格式必须为：png/jpg/jpeg/gif"),s(this).val(""),!1;const d=r(a.options.autoImageId++,"",i,e,l,this.files[0]);switch(function(s,i,t,a){const e=[];switch(e.push('<div class="upload-image-item" id="upload-image-item-'+i+"-"+a.id+'" data-id="'+a.id+'">'),e.push('<img class="upload-image" src="'+a.originSrc+'">'),e.push('<div class="upload-image-indicator">'),e.push('<p class="'+p(a.status)+'"><i class="fa fa-circle"></i> '+c(a.status)+"</p>"),e.push("</div>"),e.push('<div class="upload-image-control">'),t){case 1:break;case 2:e.push('<a href="javascript:void(0);" class="upload-a" title="上传"><i class="fa fa-upload"></i></a>')}e.push('<a href="javascript:void(0);" class="delete-a" title="删除"><i class="fa fa-trash"></i></a>'),e.push("</div>"),e.push("</div>"),s.children(".upload-images").append(e.join(""))}(o,a.options.oid,a.options.mode,d),a.options.images.push(d),a.options.mode){case 1:case 2:break;default:s.isFunction(a.options.uploadFun)?(d.status=t,u(o,a.options.oid,a.options.mode,d),a.options.uploadFun(a.options.rid,d.id,d.originData)):a.msg("upload function is necessary")}}).on("click",".eye-a",function(){"true"===s(this).attr("data-show")?(s(this).attr("data-show","false"),s(this).html('<i class="fa fa-eye-slash"></i>'),o.children(".upload-images").css("display","none")):(s(this).attr("data-show","true"),s(this).html('<i class="fa fa-eye"></i>'),o.children(".upload-images").css("display","flex"))}).on("click",".upload-multi-a",function(){a.upload()}).on("click",".upload-a",function(){const n=s(this).closest(".upload-image-item"),l=parseInt(s(n).attr("data-id"));for(let n=0,c=a.options.images.length;n<c;n++){const c=a.options.images[n];if(c.id===l){if(c.status!==i&&c.status!==e)break;s.isFunction(a.options.uploadFun)?(c.status=t,u(o,a.options.oid,a.options.mode,c),a.options.uploadFun(a.options.rid,c.id,c.originData)):a.msg("upload function is necessary");break}}}).on("click",".delete-a",function(){const i=s(this).closest(".upload-image-item"),t=parseInt(s(i).attr("data-id"));for(let s=0,i=a.options.images.length;s<i;s++){if(a.options.images[s].id===t){a.options.images.splice(s,1);break}}i.remove(),s.isFunction(a.options.deleteFun)?a.options.deleteFun(a.options.rid,a.val()):a.msg("delete function is necessary")})},update:function(i){i=s.extend(!1,{id:-1,status:!1,src:""},i);const t=this,a=t.element;for(let s=0,n=t.options.images.length;s<n;s++){const n=t.options.images[s];if(n.id===i.id){i.status?(n.status=o,n.originSrc="",n.originData=null):n.status=e,n.src=i.src,u(a,t.options.oid,t.options.mode,n);break}}},upload:function(){const n=this,l=n.element,c=n.options.images.length;if(0===c)return void n.msg("请先选择图片");let p=0,r=0;for(let d=0;d<c;d++){const c=n.options.images[d];switch(c.status){case i:case e:p++;break;case t:r++;case a:case o:default:continue}if(!s.isFunction(n.options.uploadFun))return void n.msg("upload function is necessary");c.status=t,u(l,n.options.oid,n.options.mode,c),n.options.uploadFun(n.options.rid,c.id,c.originData)}0===p&&0===r?n.msg("已全部上传完成"):r>0&&n.msg("图片正在上传")},val:function(){const s=this,i=[];for(let t=0,e=s.options.images.length;t<e;t++)s.options.images[t].status!==a&&s.options.images[t].status!==o||i.push(s.options.images[t].src);return i},msg:function(i){const t=this;s.isFunction(t.options.msgFun)?t.options.msgFun(t.options.rid,i):console.log("image-upload-msg",t.options.rid,i)}},s.fn.imageUpload=function(i){const t=arguments;return this.each(function(){const a=s(this);let e=a.data("imageUpload");e||(e=new l(a,i),a.data("imageUpload",e)),"string"==typeof i&&e[i].apply(e,Array.prototype.slice.call(t,1))})}}($);
