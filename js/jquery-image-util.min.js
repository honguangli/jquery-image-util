/*!
 * jquery-image-util v1.0 (https://github.com/honguangli/jquery-image-util)
 * Copyright honguangli
 * Licensed under the MIT license
 */
!function(s){"use strict";s.startImageViewer=function(i,t,a,o){void 0===a&&(a=window.top),void 0===t&&(t="img"),o?i.find(t).css("cursor","pointer"):i.children(t).css("cursor","pointer"),i.on("click",t,function(){const e="data-image-viewer-active";s(this).attr(e,"on");s(this).attr("src");let n=s(this).index();const l=[];o?(i.find(t).css("cursor","pointer"),i.find(t).each(function(i,t){l.push({src:s(t).attr("src")}),"on"===s(this).attr(e)&&(n=i)})):(i.children(t).css("cursor","pointer"),i.children(t).each(function(i,t){l.push({src:s(t).attr("src")})})),s(this).removeAttr(e),a.$.openImagesViewer(l,n)})},s.openImagesViewer=function(i,t,a){0===s(".image-viewer-box").length&&s("body").append('<div class="image-viewer-box"></div>');const o=s(".image-viewer-box");let e=[];e.push('<ul class="images" style="display: none;">');for(let s=0;s<i.length;s++)e.push('<li><img src="'+i[s].src+'"></li>');e.push("</ul>"),o.html(e.join(""));const n={container:".image-viewer-box",zIndex:99999999,title:!1,toolbar:{"zoom-in":!0,"zoom-out":!0,"one-to-one":!0,reset:!0,prev:!0,play:!1,next:!0,"rotate-left":!0,"rotate-right":!0,"flip-horizontal":!0,"flip-vertical":!0}},l=s(".image-viewer-box .images");l.viewer(s.extend(!0,n,a)),l.find("img").eq(t).click()};const i=0,t=1,a=2,o=500,e=200;let n=0;function l(i,t){const o=this;o.options=s.extend(!1,{mode:0,oid:null,rid:null,uploadFun:null,deleteFun:null,msgFun:null,size:0,images:[],autoImageId:0,data:[],preview:!1},t),o.element=i,o.options.oid=n++,null==o.options.rid&&(o.options.rid=o.options.oid),o.options.images=[];for(let s=0,i=o.options.data.length;s<i;s++){const i=o.options.data[s];o.options.images.push(r(o.options.autoImageId++,i,a))}o.start(),o.options.preview&&s.startImageViewer(o.element,".upload-image",parent,!0)}function c(s){switch(s){case i:return"等待上传";case t:return"正在上传";case a:return"已上传";case o:return"上传失败";case e:return"上传成功";default:return"状态异常"}}function p(s){switch(s){case i:return"upload-default";case t:return"upload-doing";case a:return"upload-finish";case o:return"upload-failure";case e:return"upload-success";default:return"upload-warning"}}function r(s,i,t,a,o,e){return void 0===a&&(a=""),void 0===o&&(o=""),void 0===e&&(e=null),{id:s,name:a,originSrc:o,originData:e,src:i,status:t}}function u(i,t,a,n){const l=s("#upload-image-item-"+t+"-"+n.id);if(0!==l.length)switch(l.find(".upload-image-indicator").html('<p class="'+p(n.status)+'"><i class="fa fa-circle"></i> '+c(n.status)+"</p>"),n.status){case e:l.children(".upload-image").attr("src",n.src),l.children(".upload-image-control").html('<a href="javascript:void(0);" class="delete-a" title="删除"><i class="fa fa-trash"></i></a>');break;case o:l.children(".upload-image-control").html('<a href="javascript:void(0);" class="upload-a" title="重新上传"><i class="fa fa-upload"></i></a><a href="javascript:void(0);" class="delete-a" title="删除"><i class="fa fa-trash"></i></a>');break;default:l.children(".upload-image-control").html('<a href="javascript:void(0);" class="delete-a" title="删除"><i class="fa fa-trash"></i></a>')}}l.prototype={start:function(){const a=this,e=a.element;e.attr("data-oid",a.options.oid);const n=[];switch(n.push('<div class="upload-images-control">'),n.push('<a href="javascript:void(0);" class="select-a" title="选择图片">选择图片<input type="file" title="选择图片"></a>'),n.push('<a href="javascript:void(0);" class="eye-a" data-show="true" title="隐藏"><i class="fa fa-eye"></i></a>'),a.options.mode){case 1:case 2:n.push('<a href="javascript:void(0);" class="upload-multi-a" title="批量上传"><i class="fa fa-upload"></i></a>')}n.push("</div>"),n.push('<div class="upload-images">');for(let s=0,i=a.options.images.length;s<i;s++){const i=a.options.images[s];n.push('<div class="upload-image-item" data-id="'+i.id+'">'),n.push('<img class="upload-image" src="'+i.src+'">'),n.push('<div class="upload-image-indicator">'),n.push('<p class="'+p(i.status)+'"><i class="fa fa-circle"></i> '+c(i.status)+"</p>"),n.push("</div>"),n.push('<div class="upload-image-control">'),n.push('<a href="javascript:void(0);" class="delete-a" title="删除图片"><i class="fa fa-trash"></i></a>'),n.push("</div>"),n.push("</div>")}n.push("</div>"),e.append(n.join("")),e.on("click",'.select-a input[type="file"]',function(){if(a.options.size>0&&a.options.size<=a.options.images.length)return a.msg("最多可选择"+a.options.size+"张图片"),s(this).val(""),!1}).on("change",'.select-a input[type="file"]',function(){if(a.options.size>0&&a.options.size<=a.options.images.length)return a.msg("最多可选择"+a.options.size+"张图片"),s(this).val(""),!1;const o=s(this).val(),n=o.substring(o.lastIndexOf(".")).toLowerCase(),l=window.URL.createObjectURL(this.files[0]);if(!n.match(/.png|.jpg|.jpeg|.gif/))return a.msg("图片格式错误，图片格式必须为：png/jpg/jpeg/gif"),s(this).val(""),!1;const d=r(a.options.autoImageId++,"",i,o,l,this.files[0]);switch(function(s,i,t,a){const o=[];switch(o.push('<div class="upload-image-item" id="upload-image-item-'+i+"-"+a.id+'" data-id="'+a.id+'">'),o.push('<img class="upload-image" src="'+a.originSrc+'">'),o.push('<div class="upload-image-indicator">'),o.push('<p class="'+p(a.status)+'"><i class="fa fa-circle"></i> '+c(a.status)+"</p>"),o.push("</div>"),o.push('<div class="upload-image-control">'),t){case 1:break;case 2:o.push('<a href="javascript:void(0);" class="upload-a" title="上传"><i class="fa fa-upload"></i></a>')}o.push('<a href="javascript:void(0);" class="delete-a" title="删除"><i class="fa fa-trash"></i></a>'),o.push("</div>"),o.push("</div>"),s.children(".upload-images").append(o.join(""))}(e,a.options.oid,a.options.mode,d),a.options.images.push(d),a.options.mode){case 1:case 2:break;default:s.isFunction(a.options.uploadFun)?(d.status=t,u(e,a.options.oid,a.options.mode,d),a.options.uploadFun(a.options.rid,d.id,d.originData)):a.msg("upload function is necessary")}}).on("click",".eye-a",function(){"true"===s(this).attr("data-show")?(s(this).attr("data-show","false"),s(this).html('<i class="fa fa-eye-slash"></i>'),e.children(".upload-images").css("display","none")):(s(this).attr("data-show","true"),s(this).html('<i class="fa fa-eye"></i>'),e.children(".upload-images").css("display","flex"))}).on("click",".upload-multi-a",function(){for(let n=0,l=a.options.images.length;n<l;n++){const l=a.options.images[n];l.status!==i&&l.status!==o||(s.isFunction(a.options.uploadFun)?(l.status=t,u(e,a.options.oid,a.options.mode,l),a.options.uploadFun(a.options.rid,l.id,l.originData)):a.msg("upload function is necessary"))}}).on("click",".upload-a",function(){const n=s(this).closest(".upload-image-item"),l=parseInt(s(n).attr("data-id"));for(let n=0,c=a.options.images.length;n<c;n++){const c=a.options.images[n];if(c.id===l){if(c.status!==i&&c.status!==o)break;s.isFunction(a.options.uploadFun)?(c.status=t,u(e,a.options.oid,a.options.mode,c),a.options.uploadFun(a.options.rid,c.id,c.originData)):a.msg("upload function is necessary");break}}}).on("click",".delete-a",function(){const i=s(this).closest(".upload-image-item"),t=parseInt(s(i).attr("data-id"));for(let s=0,i=a.options.images.length;s<i;s++){if(a.options.images[s].id===t){a.options.images.splice(s,1);break}}i.remove(),s.isFunction(a.options.deleteFun)?a.options.deleteFun(a.options.rid,a.val()):a.msg("delete function is necessary")})},update:function(i){i=s.extend(!1,{id:-1,status:!1,src:""},i);const t=this,a=t.element;for(let s=0,n=t.options.images.length;s<n;s++){const n=t.options.images[s];if(n.id===i.id){i.status?(n.status=e,n.originSrc="",n.originData=null):n.status=o,n.src=i.src,u(a,t.options.oid,t.options.mode,n);break}}},val:function(){const s=this,i=[];for(let t=0,o=s.options.images.length;t<o;t++)s.options.images[t].status!==a&&s.options.images[t].status!==e||i.push(s.options.images[t].src);return i},msg:function(i){const t=this;s.isFunction(t.options.msgFun)?t.options.msgFun(t.options.rid,i):console.log("image-upload-msg",t.options.rid,i)}},s.fn.imageUpload=function(i){const t=arguments;return this.each(function(){const a=s(this);let o=a.data("imageUpload");o||(o=new l(a,i),a.data("imageUpload",o)),"string"==typeof i&&o[i].apply(o,Array.prototype.slice.call(t,1))})}}($);
